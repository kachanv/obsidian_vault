## Глоссарий

## Storage - тип файловой системы
стандарт индустрии - распределенные файловые системы

### HDFS
**Опр:** Hadoop Distributed File System
* файловая система предназначенная для поблочного хранения больших файлов между узлами кластера
* все блоки имеют один размер (кроме  последнего) => равномерное распределение (hdfs сам равномерно распределяет по узлам тупо деля файл на равные куски)
* есть N реплик для каждого блока - настраиваемый параметр на уровне файла
* модификация файла не поддерживается, только удаление и запись
* запись в файл может осуществлять только 1 процесс
* есть N data nodes - хранят данные и 1 name node - хранит мету и расположение файлов/блоков по узлам
* HDFS может применятся отдельно от hadoop как распределенная файловая система
* HDFS надстраивается поверх файловой системы сервера т.е. является виртуальной ФС
* в настоящий момент морально устарела и использование идет на спад, предпочтения отдаются *S3*

### S3
**Опр:** *Simple Storage Service*. Плоское объектное хранилище поддерживающее API стандарта Amazon S3
* доступ к фалу/объекту осуществляется по ключу. Часто ключ = URL
* нет иерархии в ФС, она плоская. Файлы объединяются в бакеты.
* нет понятия файла или каталога. Есть понятие объекта
* на бакеты навешиваются ACL, так управляют правами
* строго говоря s3 это не файловая система


## File format
в каком формате хранить файлы в распределенной файловой системе

### Parquet
* колоночный, хранит вложенные структуры, хорошо сжимаемый (поддерживается *Spark* и *Impala*)
* Данные и таблицы (DDL) не изменяемы
* Каждая таблица представляется кучей файлов с метаданными, блоками, патрициями, статистикой, индексами и колонками данных.
* Много где поддерживается
* Вычитываются только нужные столбцы

### RCFILE
**Опр:** Record Columnar File. row-column level storage. 
* Оптимизирован под пропуски данных. 
* Делит файл на группы строк, затем каждый столбец пишет в свой файл

### ORC
**Опр:** Optimized Row Columnar
* хранит в блоках статистику min,max и т.п. 
* Хранит типы данных рядом с данными что позволяет быстро и хорошо сжимать. 
* Можно менять DDL в определенных пределах. 
* Данные делятся на пачки (у каждой пачки есть 3 блока: индексы, данные и footer) пачки на столбцы.
* По каждому столбцу своя статистика и индексы (крайние значения), которые используются для пропуска данных. 
* Поддержка ACID, лучше сжимаем.

### Avro
* бинарный строчный формат, схема, может работать с динамическими типами, данные хранятся в бинарном виде, 
* схема в json
* схема может эволюционировать
* легковесный: JSON дублирует структуру в каждом сообщении, AVRO держит структуру в схеме а передает только данные
* Уровни совместимости схем: 
	   BACKWARD - можно удалять поля, добавлять nullable поля, сравнение идет с последней версией схемы, первыми схему обновляют консюмеры,                     
	   FORWARD - можно добавлять поля, удалять nullable поля, сравнение идет с последней версией схемы, первыми схему обновляют продюсеры
	   FULL - можно добавлять/удалять nullable поля, сравнение идет с последней версией схемы, любой порядок обновления
	   NONE - нет проверки на совместимость
	   для каждого уровня (кроме NONE) есть вариант с проверкой всех версий схем а не последней
* может предаваться вместе с данными, может лежать во внешнем или локальном хранилище (реджестри) и передавать с данными только название схемы и её версию (например в confluence первый байт сообщения - версия схемы из реджестри)
* 4 кодека сжатия
* возможно ли десериализовать avro схемой с другой версией

### SEQUENCEFILE
* простой бинарник, пара ключ-значение. 
* Хорошо жмется
* оптимален для map-reduce но это row level storage со всеми вытекающими


## Table format
в каком формате хранить таблицы в  файлах. (у файла при этом свой формат)

### Iceberg
* позволяет в распределенной ФС работать с таблицами как в реляционной БД (транзакции, индексы, схемы, update и пр.)
	* при этом *File Format* может не позволять менять данные (*Parquet*)

### HUDI
