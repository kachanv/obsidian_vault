**Опр:**  генерируемый уникальный идентификатор сущности

**Глоссарий**
*BK* - busines key, натуральный уникальный ключ бизнес сущности, идентифицирующий бизнес сущность в системе источнике (СИ)

*Зачем в DWH генерировать свой SK ?*
в разных СИ - BK могут иметь разный формат или пересекаться => необходим свой идентификатор сущности на уровне DWH. Он несет чисто техническую функцию и ничего не значит для пользователей

*Если брать архитектуры Кимбалла и Инмона, в какой нет SK ?*
Есть в обеих. У Кимбалла SK используются для объединения Fact и Demension. Если есть больше 1 СИ вам придется создавать SK.

*На каком слое лучше генерировать суррогаты?*
Технически - в специальном слое справочников. Там же хранить маппинг BK и SK. 
Поскольку в DWH нет поддержки ссылочной целостности как в OLTP, легко нарваться на несогласованность, поэтому в DWH обычно есть единое место, где хранится маппинг BK и SK и происходит их техническая генерация. Это место является единственной версией правды касательно SK, и новый экземпляр сущности должен появляться именно там.

Если брать слои ODS/STG - сырые данные, DWH/DDS - декомпозиция и детальные данные, MART - витрины. То генерировать/маппить стоит в DWH/DDS.

*Генерация SK в случае асинхронных источников*
Сам механизм генерации - в любом случае будет синхронным т.к. см. пункт выше - единая точка/место т.о. все BK для которых необходима генерация SK должны обрабатываться синхронно/последовательно

*Какие варианты что делать если приходит ключ из расширения раньше супер-сущности*
В концепции DWH Tinkoff расширение сущности - подмножество ключей базовой сущности, и у них есть единый hub который содержит УМ и генерацию ключей.
Если есть такой источник расширения, куда ключи приходят раньше - он должен участвовать в генерации SK либо ставиться на CUT с лагом.

