## СИСТЕМНЫЙ КАТАЛОГ
- содержит мета информацию об БД (все объекты и отношения). Именно о БД, если в инстансе несколько БД у каждой будет свой СК
	- *gpperfmon* - служебная БД в таблицах которой сохраняется статистика запросов и системы, содержит таблицы с постфиксом _now и _hist
- SK заполняется одновременно с выполнением операции (создания/удаления и пр.), триггерами 
- SK можно редактировать с помощью стандартных SQL команд
- почти на каждый тип объектов БД есть табличка в SK (пользователи, роли, курсоры, правила, блокировки)
- *gp_* - таблицы SK уникальные для GP, *pg_* - СК стандартные для GP. SK физически лежит на *master*
	- многие объекты подразделяются на виды _all | _sys | _user
- помимо view и таблиц также есть SK функции, возвращающие какие-то значения, например дату последнего обновления таблицы
- посмотреть конфиг сервера - *show all*

Некоторые объекты SK (всего содержит примерно 70 таблиц и представлений)
* *pg_class*- таблицы 
* *pg_attribute* - поля 
* *pg_stat_activity* - инфо о выполняемых запросах в БД: OID, пользователь, запрос, 
* *pg_stat_database* - состояние БД: активные процессы, примененные отмененные транзакции 
* *pg_stat_all_tables* - о таблицах: количество сканированных строк, последний vacuum, использование индекса 
* *pg_stat_all_indexes* - о индексах: использование индекса 
* *pg_partitions* 
* *gp_configuration*
* *gp_segment_configuration*
* *pg_roles* - посмотреть свою ресурсную группу 
* *pg_namespace*
* *pg_language* - ЯП которые зарегистрированы в БД

### Сжатие каталога
- Зачем жать SK - почти каждая операция/команда перед выполнением обращается к SK. Если ddl в базе что-то меняется SK распухает - из-за *MVCC*
	- PG и как следствие GP использует *MVCC* (Multi Version Concurrency Control). Короче использует версионность для обеспечения изоляции транзакций
- раздувает ли каталог создание и удаление внешней таблицы - Да
- как мониторить раздувание каталога - *gp_toolkit.gp_bloat_diag*
- также опасно что при частых изменениях SK индекс над его таблицами перестает быть актуальным и запросы к SK начинают делать *full scan*. Поэтому наряду с *vacuum* проводят *reindex таблиц*. Что накладывает на целевую таблицу монопольную блокировку
	- сжатие каталога подразумевает полную недоступность базы. Само сжатие каталога это *vacuum analyze reindex* на таблички в схеме *pg_class* + предварительный перевод в *restricted mode*
	- *restricted mode* - запуск БД в этом режиме означает что только *superuser* может подключиться 
	- *vacuum* блокирует целевую таблицу на update, delete и analyze
- признаки раздувания каталога: утилизация CPU на *master*, долгое время компиляции запроса. SK считается раздутым если он увеличен на 25%
- любое прерывание *vacuum* каталога может повредить SK, это уже полная жопа
- в ТК SK сжимается в окно регламентного обслуживания, процесс автоматизирован